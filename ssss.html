<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Collision Detection</title>
    <style>
      .main {
        position: relative;
        width: 400px;
        height: 300px;
        border: 3px solid black;
        overflow: hidden;
        padding: 20px; /* Padding dinamik o‘zgarishi mumkin */
      }

      .moving {
        position: absolute;
        width: 50px;
        height: 50px;
        background-color: red;
        cursor: grab;
      }

      .obstacle {
        position: absolute;
        width: 100px;
        height: 100px;
        background-color: blue;
        top: 120px;
        left: 120px;
      }
    </style>
  </head>
  <body>
    <div class="main" id="main">
      <div class="moving" id="moving"></div>
      <div class="obstacle" id="obstacle"></div>
    </div>

    <script>
      const moving = document.getElementById("moving");
      const obstacle = document.getElementById("obstacle");
      const main = document.getElementById("main");

      let isDragging = false;
      let offsetX, offsetY;

      moving.addEventListener("mousedown", (e) => {
        isDragging = true;
        offsetX = e.clientX - moving.offsetLeft;
        offsetY = e.clientY - moving.offsetTop;
      });

      document.addEventListener("mousemove", (e) => {
        if (!isDragging) return;

        let newX = e.clientX - offsetX;
        let newY = e.clientY - offsetY;

        // Dinamik paddingni hisobga olish
        const mainStyles = window.getComputedStyle(main);
        const paddingX = parseInt(mainStyles.paddingLeft);
        const paddingY = parseInt(mainStyles.paddingTop);

        const maxX = main.clientWidth - moving.clientWidth - paddingX;
        const maxY = main.clientHeight - moving.clientHeight - paddingY;

        // Elementni chegarada ushlab turish
        newX = Math.max(paddingX, Math.min(newX, maxX));
        newY = Math.max(paddingY, Math.min(newY, maxY));

        moving.style.left = newX + "px";
        moving.style.top = newY + "px";

        // To‘qnashuvni tekshirish
        if (isColliding(moving, obstacle)) {
          isDragging = false; // Agar urilsa harakat to‘xtaydi
        }
      });

      document.addEventListener("mouseup", () => {
        isDragging = false;
      });

      // To‘qnashuvni aniqlash funksiyasi
      function isColliding(el1, el2) {
        const rect1 = el1.getBoundingClientRect();
        const rect2 = el2.getBoundingClientRect();

        return !(
          rect1.right < rect2.left ||
          rect1.left > rect2.right ||
          rect1.bottom < rect2.top ||
          rect1.top > rect2.bottom
        );
      }
    </script>
  </body>
</html>
